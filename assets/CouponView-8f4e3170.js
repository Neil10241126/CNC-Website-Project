import{M as g}from"./modal-f71fe47b.js";import{_ as v,o as r,b as u,e as t,t as i,k as d,v as c,U as x,r as k,F as h,d as y,f as V,n as w}from"./index-20749073.js";import"./base-component-b924db61.js";import"./selector-engine-92099f31.js";import"./focustrap-0c00f773.js";import"./component-functions-85c61d65.js";const{VITE_URL:_,VITE_PATH:b}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"neil-hexschool",BASE_URL:"/CNC-Website-Project/",MODE:"production",DEV:!1,PROD:!0},M={props:["getCoupon","isNew"],data(){return{couponModal:{},data:{},timeFormat:"111"}},methods:{updateProduct(){let s=`${_}/v2/api/${b}/admin/coupon`,e="post";this.isNew===!1&&(s=`${_}/v2/api/${b}/admin/coupon/${this.data.id}`,e="put"),this.$http[e](s,{data:this.data}).then(()=>{this.couponModal.hide(),this.getCoupon()}).catch(()=>{})},changeTime(){return this.timeFormat}},mounted(){this.couponModal=new g(this.$refs.coupon)}},E={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"coupon"},T={class:"modal-dialog"},D={class:"modal-content"},U={class:"modal-header"},N={class:"modal-title",id:"exampleModalLabel"},A=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),L={class:"modal-body"},P={class:"mb-3 row"},I=t("label",{for:"title",class:"col-sm-2 col-form-label"},"標題",-1),R={class:"col-sm-10"},F={class:"mb-3 row"},B=t("label",{for:"code",class:"col-sm-2 col-form-label"},"優惠碼",-1),H={class:"col-sm-10"},O={class:"mb-3 row"},j=t("label",{for:"percent",class:"col-sm-2 col-form-label"},"折扣數",-1),S={class:"col-sm-10"},z={class:"mb-3 row"},W=t("label",{for:"dueDate",class:"col-sm-2 col-form-label"},"到期日",-1),Y={class:"col-sm-10"},q={class:"mb-3 row align-items-center"},G=t("label",{for:"dueDate",class:"col-sm-2 col-form-label"},"到期日",-1),J={class:"col-sm-5"},K={class:"col-sm-5"},Q=["value"],X={class:"form-check"},Z=t("label",{class:"form-check-label",for:"isEnable"}," 是否啟用 ",-1),tt={class:"modal-footer"},et=t("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"},"取消",-1);function ot(s,e,p,$,o,a){return r(),u("div",E,[t("div",T,[t("div",D,[t("div",U,[t("h5",N,i(p.isNew?"新增優惠券":"修改優惠券"),1),A]),t("div",L,[t("div",P,[I,t("div",R,[d(t("input",{type:"text",class:"form-control",id:"title",placeholder:"行銷名稱","onUpdate:modelValue":e[0]||(e[0]=l=>o.data.title=l)},null,512),[[c,o.data.title]])])]),t("div",F,[B,t("div",H,[d(t("input",{type:"text",class:"form-control",id:"code",placeholder:"使用碼","onUpdate:modelValue":e[1]||(e[1]=l=>o.data.code=l)},null,512),[[c,o.data.code]])])]),t("div",O,[j,t("div",S,[d(t("input",{type:"text",class:"form-control",id:"percent",placeholder:"使用折扣","onUpdate:modelValue":e[2]||(e[2]=l=>o.data.percent=l)},null,512),[[c,o.data.percent,void 0,{number:!0}]])])]),t("div",z,[W,t("div",Y,[d(t("input",{type:"text",class:"form-control",id:"dueDate",placeholder:"有效期限","onUpdate:modelValue":e[3]||(e[3]=l=>o.data.due_date=l)},null,512),[[c,o.data.due_date,void 0,{number:!0}]])])]),t("div",q,[G,t("div",J,[d(t("input",{type:"date",class:"form-control",id:"dueDate",ref:"timeValue","onUpdate:modelValue":e[4]||(e[4]=l=>o.timeFormat.valueAsNumber=l)},null,512),[[c,o.timeFormat.valueAsNumber,void 0,{number:!0}]])]),t("div",K,[t("input",{type:"text",class:"form-control text-danger",value:o.timeFormat,readonly:""},null,8,Q)])]),t("div",X,[d(t("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"isEnable","onUpdate:modelValue":e[5]||(e[5]=l=>o.data.is_enabled=l)},null,512),[[x,o.data.is_enabled,void 0,{number:!0}]]),Z])]),t("div",tt,[et,t("button",{type:"button",class:"btn btn-secondary",onClick:e[6]||(e[6]=l=>a.updateProduct())},"儲存")])])])],512)}const st=v(M,[["render",ot]]),{VITE_URL:m,VITE_PATH:f}={VITE_URL:"https://vue3-course-api.hexschool.io",VITE_PATH:"neil-hexschool",BASE_URL:"/CNC-Website-Project/",MODE:"production",DEV:!1,PROD:!0},lt={data(){return{coupons:[],isNew:!1}},components:{CouponModal:st},methods:{checkAdmin(){this.$http.post(`${m}/v2/api/user/check`).then(()=>{this.getCoupon()}).catch(()=>{this.$router.push("/login")})},getCoupon(){this.$http.get(`${m}/v2/api/${f}/admin/coupons`).then(s=>{this.coupons=s.data.coupons}).catch(()=>{})},deleteCoupon(s){this.$http.delete(`${m}/v2/api/${f}/admin/coupon/${s}`).then(()=>{this.getCoupon()}).catch(()=>{})},openModal(s,e){s==="add"?(this.isNew=!0,this.$refs.modal.data={},this.$refs.modal.couponModal.show()):s==="put"&&(this.isNew=!1,this.$refs.modal.data={...e},this.$refs.modal.couponModal.show())},deadLine(s){const e=new Date(s);return`${e.getFullYear()}/${e.getMonth()+1}/${e.getDate()}`}},mounted(){const s=document.cookie.replace(/(?:(?:^|.*;\s*)CookieToken\s*=\s*([^;]*).*$)|^.*$/,"$1");this.$http.defaults.headers.common.Authorization=s,this.checkAdmin()}},nt={class:"d-flex justify-content-between align-items-center py-4"},at=t("h2",{class:"fs-1 lh-base m-0"},"優惠券列表",-1),dt={class:"table table-hover border align-middle"},it=t("thead",null,[t("tr",{class:"table-dark"},[t("th",null,"標題"),t("th",null,"優惠碼"),t("th",null,"折扣數"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"操作")])],-1),ct={class:"btn-group",role:"group","aria-label":"Basic example"},rt=["onClick"],ut=["onClick"];function mt(s,e,p,$,o,a){const l=k("CouponModal");return r(),u(h,null,[t("div",nt,[at,t("button",{type:"button",class:"btn btn-outline-primary",onClick:e[0]||(e[0]=n=>a.openModal("add"))},"新增優惠券")]),t("table",dt,[it,t("tbody",null,[(r(!0),u(h,null,y(o.coupons,n=>(r(),u("tr",{key:n.id},[t("td",null,i(n.title),1),t("td",null,i(n.code),1),t("td",null,i(`${n.percent} %`),1),t("td",null,i(a.deadLine(n.due_date)),1),t("td",{class:w([{"text-success":n.is_enabled},{"text-danger":!n.is_enabled}])},i(n.is_enabled?"已啟用":"未啟用"),3),t("td",null,[t("div",ct,[t("button",{type:"button",class:"btn btn-dark",onClick:C=>a.openModal("put",n)},"編輯",8,rt),t("button",{type:"button",class:"btn btn-danger",onClick:C=>a.deleteCoupon(n.id)},"刪除",8,ut)])])]))),128))])]),V(l,{ref:"modal","get-coupon":a.getCoupon,"is-new":o.isNew},null,8,["get-coupon","is-new"])],64)}const $t=v(lt,[["render",mt]]);export{$t as default};
